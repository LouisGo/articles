---
title: è®°ä¸€æ¬¡ç®€å•çš„ä¸šåŠ¡æ”¹é€ 
date: 2021-07-01
author: LouisGo
author_title: ä¸€ä»‹å‰ç«¯
author_image_url: https://i.loli.net/2021/07/10/sfmijBHXGraYDTA.jpg
keywords: [ä¸šåŠ¡æ”¹é€ , æœ€ä½³å®è·µ, react, reactæ–°æ‰‹, vueè½¬react, typescript]
tags: [å‰ç«¯, æœ€ä½³å®è·µ]
---

# è®°ä¸€æ¬¡ç®€å•çš„ä¸šåŠ¡æ”¹é€ 

## èƒŒæ™¯<a id="1"></a>

ä» Vue åˆè½¬ React æŠ€æœ¯æ ˆï¼Œæ¬ç –è¿‡ç¨‹ä¸­åˆšå¥½æœ‰ä¸ªé€šç”¨ä¸šåŠ¡åœºæ™¯ç»ƒæ‰‹ï¼Œé¡ºä¾¿è®°å½•ä¸€ä¸‹è¿½é€â€œæœ€ä½³å®è·µâ€çš„è¿‡ç¨‹ï¼ˆè™½ç„¶å¾ˆå¯èƒ½ä¸€ä¸ªæœˆåå°±ä¼šå˜æˆè‡ªå·±éƒ½å«Œå¼ƒçš„ ğŸŒ¶ ğŸ” ä»£ç ï¼‰ã€‚

å› å¯¹ React çš„ç†è§£æœ‰é™ï¼Œæœ‰äº›ä»£ç å’Œæ€è·¯å¯èƒ½æ˜¾å¾—å¹¼ç¨šï¼Œç»“æœä¹Ÿè‚¯å®šä¸æ˜¯æœ€ä½³å®è·µã€‚ä½†æˆ‘è®¤ä¸ºç»“æœå¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯èƒ½åˆ†äº«ä¸€ä¸‹æˆ‘çš„ä¼˜åŒ–æ€è·¯å’Œå®è·µè¿‡ç¨‹ï¼Œå¦‚æœèƒ½å¯¹åˆè½¬ react çš„ç«¥é‹æœ‰æ‰€å¯å‘ï¼Œé‚£æ˜¯æœ€å¥½æ»´ã€‚

**æœ¬ç¯‡ä¸ä¼šè®²æ‰€æœ‰æŠ€æœ¯å®ç°ç»†èŠ‚ï¼Œåªæ‹å‡ºæ¥æˆ‘è®¤ä¸ºæœ€å…³é”®çš„éƒ¨åˆ†**ï¼Œå·¥å¤´å–Šæˆ‘å»æ¬ç –äº†...

<!--truncate-->

æ–‡ç« è¾ƒé•¿ï¼ŒäºŒçº§ç›®å½•å¦‚ä¸‹ï¼š

[1 èƒŒæ™¯](#1)

[2 åœºæ™¯ä»‹ç»](#2)

[3 è¿‡ç¨‹](#3)

&nbsp;&nbsp;[3.1 TypeScript æ”¹é€ ](#3.1)

&nbsp;&nbsp;[3.2 Redux æ–­èˆç¦»](#3.2)

&nbsp;&nbsp;[3.3 ç°æˆè½®å­](#3.3)

&nbsp;&nbsp;[3.4 è¿›ä¸€æ­¥æŠ½è±¡](#3.4)

&nbsp;&nbsp;[3.5 è·¯ç”±ç¼“å­˜](#3.5)

&nbsp;&nbsp;[3.6 åŠ ç‚¹å°ç©æ„å„¿](#3.6)

&nbsp;&nbsp;[3.7 Code Spell Checker](#3.7)

[4 æ€»ç»“](#4)

## åœºæ™¯ä»‹ç»<a id="2"></a>

å¯¹äºä¸‹é¢è¿™æ ·ä¸€ä¸ªç®€å•çš„åå°ç®¡ç†ç³»ç»Ÿè¡¨æ ¼å±•ç¤ºç•Œé¢ï¼Œæˆ‘ä»¬åº”è¯¥æ—©å·²å¸ç©ºè§æƒ¯ï¼š

![image.png](https://i.loli.net/2021/06/28/cYZQs3trPmpgkOH.png)

ä»¥ React + React-router + Redux + TypeScript + Antd æŠ€æœ¯æ ˆä¸ºå‰æï¼Œåœ¨ç¬¬ä¸€æ—¶é—´æˆ‘ä»¬è‰æ‹Ÿå‡ºä»¥ä¸‹å¤§æ¦‚çš„ç»„ä»¶åˆ’åˆ†æ€è·¯ï¼š

![cYZQs3trPmpgkOH.png](https://i.loli.net/2021/06/28/89ik2UxzdOZImJr.png)

## è¿‡ç¨‹<a id="3"></a>

æŒ‰ç…§ä¸Šå›¾çš„è§„åˆ’ï¼Œå…¶å® Antd å·²ç»å¸®æˆ‘ä»¬å®Œæˆäº†å¤§éƒ¨åˆ†çš„å·¥ä½œã€‚æˆ‘ä»¬è¦åšçš„å¯èƒ½å°±æ˜¯â€œç®€å•çš„â€å¤„ç†æ¥å£è¯·æ±‚ä»¥åŠâ€œæ”¿æ²»æ­£ç¡®â€çš„ä½¿ç”¨ redux å»ç»„ç»‡è§†å›¾æ•°æ®ï¼Œè¿™é‡Œæˆ‘ä»¬æ›´è¿‘ä¸€æ­¥ä½¿ç”¨äº†å®˜æ–¹å·¥å…·é›† @reduxjs/toolkitã€‚

å¬èµ·æ¥ä¸é”™ï¼Ÿä½†æ˜¯å½“æˆ‘æ¥æ‰‹æ—§é¡¹ç›®çš„æ—¶å€™å¾ˆå¿«å°±å‘ç°äº†ç¬¬ä¸€ä¸ªæ‰çœ¼çš„é—®é¢˜ï¼šTypeScript ç±»å‹ç¼ºå¤±ã€‚å¯¹äºå¤„å¥³åº§æ¥è¯´ä¸èƒ½å¿ï¼Œäºæ˜¯é¦–å…ˆå¼€å¯çš„æ˜¯ç–¯ç‹‚çš„â€œè¡¥é½â€ä¹‹æ—…...

### TypeScript æ”¹é€ <a id="3.1"></a>

#### 1. æ¥å£è¯·æ±‚æ–¹æ³•

æ“’è´¼å…ˆæ“’ç‹ï¼Œé¦–å…ˆæ‰¾åˆ°åŠ¨æ€æ•°æ®çš„æœ€ä¸»è¦æ¥æºâ€”â€”**å¼‚æ­¥è¯·æ±‚**ï¼š

```diff
+ import { ActivityList } from 'src/types'
export function getConnectList(params: ConnectListParams) {
- return request.get('/v1/offline-business-connect/list', {
+ return request.get<ActivityList>('/v1/offline-business-connect/list', {
    params: {
      is_close: params.isClose || '',
      page: params.page || 1,
      page_size: params.page_size || 10,
      keyword: params.keyword || '',
    },
  });
}
```

ä¹‹å‰çš„è¿”å›ç±»å‹å®Œå…¨æœªçŸ¥ï¼Œç°åœ¨ä¼ å…¥ ActivityList æ³›å‹ï¼Œå¹¶ä¸”ç”¨ GetActivityListParams è¿›è¡Œè¯·æ±‚å‚æ•°çº¦æŸï¼ˆé€šè¿‡ä¸‹é¢çš„ç‰¹æ®Šæ³¨é‡Šæ–¹å¼ï¼Œå¯ä»¥åœ¨ vscode ç­‰ç°ä»£ IDE ä¸­è·å–æ³¨é‡Šæç¤ºï¼‰ã€‚

```typescript
/**
 * æ´»åŠ¨åˆ—è¡¨è¯·æ±‚å‚æ•°
 */
export interface GetActivityListParams {
  isClose?: string | number;
  page?: string | number;
  page_size?: string | number;
  keyword?: string | number;
  type?: string | number;
}

/**
 * æ´»åŠ¨åˆ—è¡¨
 */
export interface ActivityList {
  /* æ€»æ•° */
  total_count: number;
  /* åˆ—è¡¨ */
  list: ActivityListItem[];
}

/**
 * æ´»åŠ¨åˆ—è¡¨è¯¦æƒ…
 */
export type ActivityListItem = {
  /** æ´»åŠ¨ç»“æŸæ—¶é—´ */
  activity_end_time: string;
  /** æ´»åŠ¨å¼€å§‹æ—¶é—´ */
  activity_start_time: string;
  /** æ´»åŠ¨åœ°å€ */
  activity_url: string;
  /** æ´»åŠ¨åç§° */
  area_name: string;
  /** å¼€å‘å•†æ”¶é›†é“¾æ¥ */
  demand_collect_url: string;
  /** æŠ¥åéœ€æ±‚æ•°ç›® */
  developer_apply_count: number;
  /** æŠ¥åå¼€å‘å•†æ•°ç›® */
  developer_register_count: number;
  /** æ˜¯å¦ä¸‹æ¶ */
  is_close: 0 | 1;
  /** æŠ¥åä¾›åº”å•†æ•°ç›® */
  supplier_register_count: number;
  /** æ´»åŠ¨id */
  uid: number;
};
```

![image.png](https://i.loli.net/2021/06/02/jsYFr8QNe4doHpA.png)

ä¸é”™çš„å¼€å§‹ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨ä¸€æ¬¡åŸºæœ¬è¯·æ±‚ä¸­æ¥å£æ•°æ®çš„è¾“å…¥ç«¯å’Œè¾“å‡ºç«¯éƒ½æœ‰äº†ç±»å‹çº¦æŸçš„ä¿éšœï¼Œå¥½åƒå¼€å§‹å¥½èµ·æ¥äº†ï¼Ÿ

~~è™½ç„¶å†™å®Œæ¥å£å®šä¹‰çš„æ ·å­å¾ˆé“ä»”ï¼Œä½†æ˜¯ä½ å·¥å…·äººèˆ¬å€’è…¾ç±»å‹æ—¶çš„æ¼«é•¿å²æœˆçœŸçš„å¥½ç‹¼ç‹ˆ~~~

è¿™ç§â€œè„åˆç´¯â€è¿˜å®¹æ˜“å‡ºé”™çš„æ´»å„¿æœ€å¥½äº¤ç»™å·¥å…·ï¼Œå½“ç„¶ç»ˆææ¢¦æƒ³æ˜¯ç›´æ¥ç”±åå°å¸¦å‡ºï¼Œè¿™é‡Œæ„Ÿè°¢ç»„å†…å°ä¼™ä¼´è´¡çŒ®çš„å¥½ä¸œè¥¿ä¸‰æšï¼š

1. [JSON è½¬ typescript å®šä¹‰å®ç”¨å·¥å…·](https://etctest.cyzl.com/hello_json)ï¼Œæ ¹æ® JSON æ ¼å¼è‡ªåŠ¨ç”Ÿæˆç±»å‹å®šä¹‰ï¼Œç®€å•ç²—æš´ä½†æ˜¯ç°é˜¶æ®µå¾ˆå®ç”¨
2. [åŸºäº swagger3 çš„å®ç”¨ typescript å·¥å…·](https://www.npmjs.com/package/swagger-ts-define)ï¼Œè‡ªåŠ¨åŒ–ç¨‹åº¦å¾ˆé«˜ï¼Œä½†æ˜¯å¼ºä¾èµ–äº swagger3ï¼Œå¯ä»¥å‚è€ƒæºç æ€è·¯
3. [åŸºäº YApi çš„ typescript å’Œ api request è‡ªåŠ¨ç”Ÿæˆå·¥å…·](https://github.com/fjc0k/yapi-to-typescript)ï¼Œéœ€è¦èŠ±åŠŸå¤«é›†æˆï¼Œæœªæ¥å¯æœŸ

##### è¯·æ±‚å°æ’æ›²

è¿™é‡Œé‡åˆ°äº†å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸èƒ½é‡åˆ°çš„ä¸€ä¸ªé”™è¯¯å†™æ³•ï¼š

```typescript
// bad code
export function getActivityList(params: GetActivityListParams) {
  return request.get<ActivityList>('/v1/xxx/list', {
    params: {
      is_close: params.isClose || '',
      page: params.page || 1,
      page_size: params.page_size || 10,
      keyword: params.keyword || '',
      type: params.type || '',
    },
  });
}
```

é—®é¢˜å‡ºåœ¨ `||`ï¼Œæˆ‘ä»¬çš„æœ¬æ„æ˜¯å½“å·¦è¾¹çš„å€¼ä¸å­˜åœ¨çš„æ—¶å€™ç”¨å³è¾¹çš„å€¼è¿›è¡Œ fallbackï¼Œç†è®ºä¸Šæ¥è¯´æ˜¯è‰¯å¥½çš„ä¹ æƒ¯å€¼å¾—æå€¡ï¼Œä½†åœ¨è¿™é‡Œå°±æ˜¯â€œå¥½å¿ƒå¹²åäº‹â€äº†ã€‚

å½“å·¦è¾¹çš„å€¼ä¸º 0 æ—¶ï¼Œéšå¼è½¬æ¢ä¼šè®©æˆ‘ä»¬åŸæœ¬æœŸæœ›ä¼ çš„`is_close`æšä¸¾ä»`0`å˜æˆäº† `''`ã€`page`ä»`0`å˜æˆ`1`ã€‚è¿™ç§æƒ…å†µä¸‹è¦å°å¿ƒç”„åˆ«è¿›è¡Œç±»å‹åˆ¤æ–­ã€‚

#### 2. redux ç›¸å…³

è®©æˆ‘ä»¬å…ˆæ¥å—â€œé¡¹ç›®å°±æ˜¯éœ€è¦ reduxâ€çš„è®¾å®šï¼Œç„¶åå»è§£å†³ä¸€äº›å®é™…å­˜åœ¨çš„æœ‰ç”¨çš„é—®é¢˜ã€‚

**redux æ˜¯æˆ‘ä»¬ç°åœ¨å®é™…ä½¿ç”¨æ•°æ®çš„æŒ‡æŒ¥ä¸­å¿ƒå’Œè°ƒåº¦ä¸­å¿ƒï¼Œcapture value ç”±è¿™é‡Œæ´¾å‘ï¼Œé¡µé¢çš„æ•°æ®æ“ä½œæœ€ç»ˆä¹Ÿé€šè¿‡ dispatch æ¥åˆ°è¿™é‡Œè¿›è¡Œå¼‚æ­¥å¤„ç†**ã€‚

ç”±äºé¡¹ç›®é‡Œé‡‡ç”¨`@loadable/component`å®ç°è·¯ç”±çš„å¼‚æ­¥åŠ è½½ï¼Œå› æ­¤ä¼šå¯¼è‡´åŠ¨æ€åŠ è½½çš„æ¨¡å—å¯¹åº”çš„ reducer ä¸å­˜åœ¨ï¼Œè§£å†³æ€è·¯æ˜¯åœ¨è¿è¡Œæ—¶å°†å½“å‰æ¨¡å—å¯¹åº”çš„ reducer å’Œå·²æœ‰çš„é™æ€å’ŒåŠ¨æ€ reducers è¿›è¡Œä¸€æ¬¡åˆå¹¶ç„¶ååŠ¨æ€æ³¨å…¥ï¼ˆ`store.replaceReducer`ï¼‰ã€‚

å¯¹åº”çš„å·¥å…·æ–¹æ³• injectReducerï¼Œç»´æŠ¤äº†ä¸€ä¸ª asyncReducers å¯¹è±¡ï¼Œåœ¨è·¯ç”±åˆ‡æ¢æ—¶ä¸æ–­è¿›è¡Œå¯¹æ–°æ—§ reducer è¿›è¡Œåˆå¹¶æ“ä½œï¼š

```typescript
// core
const asyncReducers: LooseObject = {};
export function injectReducer<State>(key: string, reducer: Reducer<State>) {
  asyncReducers[key] = reducer;
  const newRootReducer = combineReducers({
    ...staticReducers,
    ...asyncReducers,
  });
  store.replaceReducer(newRootReducer);
}
// å®é™…ä½¿ç”¨
// other.tsx
import { sliceName, sliceReducer } from './slice';
// ...
injectReducer(sliceName, sliceReducer);
// ...
```

æˆ‘ä»¬å¯ä»¥æŠŠæ­¤æ—¶çš„ redux ç†è§£ä¸ºä¸€è¶Ÿå¯ä»¥åœ¨è·¯ç”±åœ°å›¾é‡Œä»»æ„è¡Œé©¶çš„åˆ—è½¦ï¼Œé©±åŠ¨çš„ç«è½¦å¤´å³æ˜¯ rootReducerï¼Œå®ƒæ˜¯å§‹ç»ˆä¸å˜çš„ï¼Œä½†æ˜¯å½“è¿è¡Œåˆ° Page A è·¯ç”±è½¦ç«™æ—¶ï¼Œé€šè¿‡ hot replace çš„æ–¹å¼æŠŠåè½¦å¢æ›¿æ¢æˆå½“å‰è·¯ç”±éœ€è¦çš„ Page A è½¦å¢ï¼ˆAsync Reducerï¼‰ï¼š

![image.png](https://i.loli.net/2021/06/30/CNwgqY6Vkpn2vQB.png)

è¿™ç§åšæ³•è§£å†³äº†ä¸Šä¸‹æ–‡åˆ‡æ¢çš„é—®é¢˜ï¼Œä½†åˆ‡æ¢æ—¶å¤šäº†ä¸€äº›ï¼ˆæ²¡æœ‰è¿›è¡Œç¼“å­˜ï¼‰è¿è¡Œæ—¶å¼€é”€ã€‚

åŒæ—¶å¸¦å‡ºäº†ç¬¬äºŒä¸ªé—®é¢˜ï¼š**ä½œä¸ºé™æ€ç±»å‹è¯­è¨€ typescript æ˜¯æ²¡åŠæ³•åšåˆ°è¿è¡Œæ—¶çš„ç±»å‹æ’æ‹¨çš„**ï¼Œæˆ‘ä»¬å¾—ç”¨â€œæ–­è¨€â€çš„æ€è·¯å»å¤„ç†ï¼Œå³**è·¯ç”±åˆ°äº†è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘éœ€è¦æ˜ç¡®çš„çŸ¥é“å½“å‰çš„ redux éœ€è¦ä½•ç§ç±»å‹çš„æ•°æ®ï¼Œå¹¶ä¸æ ¹æ•°æ®è¿›è¡Œç±»å‹åˆå¹¶**ã€‚å¥½åœ¨`injectReducer`æ‰§è¡Œæ³¨å…¥çš„æ—¶æœºåˆšå¥½å°±æ˜¯æˆ‘ä»¬æœ‰äº†â€œæ˜ç¡®çš„çŸ¥é“å½“å‰çš„ redux éœ€è¦ä½•ç§ç±»å‹çš„æ•°æ®â€çš„å‰æï¼Œå‰©ä¸‹çš„äº‹å°±åªæœ‰â€œç±»å‹åˆå¹¶â€äº†ï¼Œæ ¸å¿ƒä»£ç æ˜¯ä¸‹é¢`ApplyListState`è”åˆç±»å‹çš„å†™æ³•ï¼š

```typescript
import { createSlice } from '@reduxjs/toolkit';
// æ ¹æ•°æ®ç±»å‹
import { RootState } from 'src/reducers';
// åˆå§‹å€¼ï¼ˆstateç±»å‹å‡ºå¤„ï¼‰
export const initialState = {
  isFetching: true,
  isLoaded: false,
  data: {
    list: [],
    total_count: 0,
    is_allowed_list_export: false,
  } as ApplyList,
};
// ç”¨ `as const` æ˜¯ä¸ºäº†æ¥ä¸‹æ¥ç”¨ä½œè”åˆç±»å‹çš„ key å€¼ã€‚
export const applyListSliceName = 'applyListSlice' as const;

const applyListSlice = createSlice({
  name: applyListSliceName,
  initialState,
  extraReducers(builder) {
    // å¼‚æ­¥è¯·æ±‚çš„reducerå¤„ç†
    builder
      .addCase(getApplyList.pending, (state) => {
        state.isFetching = true;
        state.isLoaded = true;
      })
      .addCase(getApplyList.fulfilled, (state, action) => {
        state.isFetching = false;
        state.isLoaded = false;
        state.data = action.payload;
      })
      .addCase(getApplyList.rejected, (state) => {
        state.isFetching = false;
        state.isLoaded = false;
      });
  },
  reducers: {},
});

// export reducer
export const applyListReducer = applyListSlice.reducer;

// ç±»å‹åˆå¹¶
export type ApplyListState = RootState & {
  [applyListSliceName]: ReturnType<typeof applyListReducer>;
};
```

#### 3. å®é™…ä½¿ç”¨ç›¸å…³

ä¸¾ä¸ªæœ€å®¹æ˜“è§‚å¯Ÿçš„ä¾‹å­ï¼šç»™ Antd Table ç»„ä»¶çš„ columns å¯¹è±¡ä¼ å…¥å®é™…æ³›å‹è¿›è¡Œçº¦æŸ

```typescript
import { Table, TableColumnsType } from 'antd';
// æ¡ç›®ç±»å‹
import { ApplyListItem } from 'src/api/applyList';
// ...
// ç»™TableColumnsTypeä¼ å…¥ApplyListItem
const columns: TableColumnsType<ApplyListItem> = [
  //...
];
// ...
return <Table columns={columns} rowKey={(record) => record.id} />;
```

å®é™…æ•ˆæœï¼š ![image.png](https://i.loli.net/2021/06/02/QyCG9geRfd4mAiO.png)

### Redux æ–­èˆç¦»<a id="3.2"></a>

è®©æˆ‘ä»¬å¿˜æ‰ tsï¼Œç›®å…‰å›åˆ°è¿™å¹…åˆ’åˆ†å›¾ â†“ æ¢³ç†ä¸€ä¸‹æˆ‘ä»¬ç°åœ¨éœ€è¦çš„ä¸»ä½“ä¿¡æ¯ï¼š

![cYZQs3trPmpgkOH.png](https://i.loli.net/2021/06/28/89ik2UxzdOZImJr.png)

#### ä¸å˜çš„éƒ¨åˆ†

å¯ä»¥çœ‹åˆ°ä¸­é—´å’Œåº•éƒ¨åŒºåŸŸæ˜¯æ¯ä¸ªè¡¨æ ¼å±•ç¤ºé¡µéƒ½å¿…ç„¶æœ‰çš„éƒ¨åˆ†ï¼š

ä¸­é—´çš„ Table ç»„ä»¶ï¼Œæ ¸å¿ƒçš„ props æœ‰ï¼š

1. åˆ—é…ç½® columnsï¼Œè´Ÿè´£ Table.Columns çš„å±•ç¤º
2. æ•°æ®åˆ—è¡¨ dataSourceï¼Œè´Ÿè´£ Table.Rows çš„å±•ç¤º
3. åŠ è½½çŠ¶æ€ loadingï¼Œè´Ÿè´£åŠ è½½çŠ¶æ€çš„å±•ç¤º

åº•éƒ¨çš„ Pagination ç»„ä»¶ï¼Œæ ¸å¿ƒçš„ props æœ‰ï¼š

1. åˆ†é¡µç´¢å¼• pageIndex
2. å•é¡µæ•°æ®é‡ pageSize
3. æ•°æ®æ€»æ•° total
4. onChange å›è°ƒå‡½æ•°ï¼Œè´Ÿè´£å¤„ç†å½“å‰åˆ†é¡µå’Œé‡æ–°è¯·æ±‚

**å¯ä»¥çœ‹åˆ°ä»¥ä¸Šæ¯é¡¹éƒ½è·Ÿæ¥å£æ•°æ®äº¤äº’æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½éœ€è¦åœ¨ redux ä¸­è¿›è¡Œç›¸åº”çš„ç»´æŠ¤**

æ¥å£è¯·æ±‚å¸¦æ¥äº†å¾ˆå¤šç›¸åŒçš„è¦æ±‚ï¼šè½®è¯¢/é˜²æŠ–/èŠ‚æµ/ç¼“å­˜...

ä¸æ­¤åŒæ—¶å¦‚æ­¤ç®€å•çš„é¡µé¢å´è¦å†™ä¸€å¤§å †æ— æ³•å¤ç”¨çš„ redux æ ·æœ¬ä»£ç ï¼Œæ­¤æ—¶è¿™ç§æ¨¡å¼å¸¦æ¥çš„å¿ƒæ™ºè´Ÿæ‹…ä¸å¯è°“ä¸å¤šï¼š

1. é€šè¿‡`createSlice`æ„é€  reducer å’Œ actions
2. ç”¨`createSelector`å°†é¡µé¢å®é™…ç”¨åˆ°çš„æ•°æ®è¿›è¡Œç¼“å­˜å¤„ç†åˆ†å‘
3. å¼‚æ­¥è¯·æ±‚çš„çŠ¶æ€æŒæœ‰ï¼ˆloading/error/data...ï¼‰
4. é€šè¿‡`createAsyncThunk`å¯¹å¼‚æ­¥è¯·æ±‚è¿›è¡Œå°è£…å¹¶å°†è¿™ä¸ª thunk ç”¨ extraReducers è¿›è¡Œå„ç§çŠ¶æ€æµçš„å¤„ç†
5. åœ¨å®é™…é¡µé¢ä¸­å¼•å…¥å¹¶ inject å¯¹åº” reducer
6. åœ¨å®é™…é¡µé¢ä¸­å¼•å…¥ `useDispatch`ã€`useSelector`å’Œå¯¹åº”çš„ actionsã€selectsï¼Œå¼•ç”¨ä¸€æ¡å˜é‡éœ€è¦`const state1 = useSelector(selectState1())`ï¼Œè°ƒç”¨ä¸€ä¸ª action éœ€è¦`dispatch(action1())`
7. ä¸ºäº†æ–¹ä¾¿å¤„ç†å¾ˆå¯èƒ½è¿˜éœ€è¦ç”¨å„ç§ä¸å¿…è¦çš„å˜é‡å’Œæ–¹æ³•å»æ¥æ”¶ redux å¯¼å‡ºçš„å„ç§â€œæ¦‚å¿µâ€

æ­¤æ—¶æˆ‘ä»¬çš„ç•Œé¢å½¢å¼æ˜¯è¿™æ ·çš„ï¼ˆç»¿è‰²ä¸ºæ•°æ®å˜é‡ï¼Œç´«è‰²ä¸º actionï¼Œé»„è‰²ä¸ºå®é™…é¡µé¢ï¼Œä¸­é—´è™šçº¿ç•™ä¸ªå°å°æ‚¬å¿µï¼‰ï¼ŒçœŸæ­£çš„å±•ç¤ºé¡µé¢å’Œ redux æ˜¯åˆ†ç¦»çš„ï¼Œredux é€šè¿‡èŒƒå¼åŒ–åçš„ selector å’Œ dispatch ä¸å±•ç¤ºé¡µé¢è¿›è¡Œè¿æ¥ï¼š

![image.png](https://i.loli.net/2021/07/01/lYtquc1HRo6NESe.png)

è²Œä¼¼çœ‹èµ·æ¥åˆ†å·¥æ˜ç¡®ï¼Ÿå¯ä»¥çœ‹åˆ°ç»¿è‰²å’Œç´«è‰²éƒ¨åˆ†å¾ˆæ˜æ˜¾æ˜¯**ç›¸åŒçš„ä¸åŒç»„æˆéƒ¨åˆ†**ã€‚ç¿»è¯‘æˆäººè¯å†è¯´ä¸€éï¼š**A å’Œ B çš„å…·ä½“æ•°æ®å€¼å’Œæ“ä½œæ–¹æ³•å¯èƒ½ä¸åŒï¼Œä½†æ˜¯ä»–ä»¬ä»£ç çš„ç»„ç»‡å½¢å¼æ˜¯å®Œå…¨ä¸€è‡´ä¸”å®Œå…¨å¯ä»¥å¤ç”¨çš„**ã€‚

æ­¤æ—¶ redux å´å¦‚åŒä¸€é“å±éšœæŠŠä»–ä»¬ç›¸éš”ï¼Œå¹¶ä¸”å®é™…å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬çš„å…³æ³¨ç‚¹ä¸æ–­çš„åœ¨é¡µé¢é€»è¾‘æœ¬èº«å’Œ redux å¯¹åº”çš„ stateã€actionsã€selector ä¸­æ¨ªè·³ï¼ˆä¹Ÿå°±æ˜¯å›¾ä¸­çš„ç»¿è‰²ã€ç´«è‰²ã€é»„è‰²éƒ¨åˆ†ï¼‰ï¼ŒåŠ ä¸€ä¸ªç®€å•çš„å˜é‡åŠ¨è¾„è¦æ”¹åŠ¨å¥½å‡ ä¸ªåœ°æ–¹ã€‚

æˆ‘æ„¿ç§°ä¹‹ä¸º**å…³æ³¨ç‚¹åœ¨ä¸åŒæ–‡ä»¶ä¸­æ¨ªè·³**ã€‚

æ³¨æ„ï¼šå¹¶éæŒ‡è´£å¤šæ–‡ä»¶å½¢å¼æœ¬èº«ï¼ŒES6 çš„æ¨¡å—åŒ–å°±æ˜¯åŸºäºæ­¤ï¼Œå…³é”®ç‚¹åœ¨äº**æ— æ•ˆçš„å¤šæ–‡ä»¶å½¢å¼**ã€‚

#### å˜åŠ¨çš„éƒ¨åˆ†

åˆšæ‰è™šçº¿çš„éƒ¨åˆ†ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬å¯¹è¡¨æ ¼çš„æ“ä½œåŒºåŸŸï¼Œæ¯”å¦‚å…³é”®è¯æœç´¢ã€é€‰é¡¹ç­›é€‰ã€æ–°å¢æŒ‰é’®ã€å¯¼å…¥/å¯¼å‡ºï¼Œæ¯ä¸ªé¡µé¢éƒ½ä¸ä¸€æ ·ï¼Œæœ‰äº›é¡µé¢å¯èƒ½å‹æ ¹éƒ½æ²¡æœ‰ï¼Œä¸‹å›¾ç”¨çº¢çº¿åœˆå‡ºï¼š

![image.png](https://i.loli.net/2021/07/01/6B2uQw8gEC9mxDl.png)

å¯¹äºè¿™ç§çµæ´»æ€§æå¼ºçš„éœ€æ±‚æˆ‘ä»¬ä¼¼ä¹æ²¡æœ‰åŠæ³•äº†ï¼Œäºæ˜¯ä»£ç é‡Œå……æ–¥ç€ï¼š

```typescript
// ç‰¹åˆ«å¼ºè°ƒï¼è¿™é‡Œçš„ä»£ç è¿˜ç»è¿‡äº†ç®€åŒ–ï¼åˆ¨é™¤äº†reduxçš„æ‰€æœ‰å½±å“ï¼
// ç‰¹åˆ«å¼ºè°ƒï¼è¿™é‡Œçš„ä»£ç è¿˜ç»è¿‡äº†ç®€åŒ–ï¼åˆ¨é™¤äº†reduxçš„æ‰€æœ‰å½±å“ï¼
// ç‰¹åˆ«å¼ºè°ƒï¼è¿™é‡Œçš„ä»£ç è¿˜ç»è¿‡äº†ç®€åŒ–ï¼åˆ¨é™¤äº†reduxçš„æ‰€æœ‰å½±å“ï¼
const demo: React.FC = () => {
  const [keyword, setKeyword] = useState('');
  const [status, setStatus] = useState('');
  // åšå…¶ä»–ä¸€å¤§å †äº‹
  // ...
  const onChangeKeyWord = () => {};
  const onSearch = () => {};
  const onStatusChange = () => {};
  // åšå…¶ä»–ä¸€å¤§å †äº‹
  // ...
  return (
    <div>
      // ä¸‹é¢è¿™ä¸ªéƒ¨åˆ†
      <Input
        placeholder="è¯·è¾“å…¥å…³é”®è¯"
        onChange={onChangeKeyword}
        onPressEnter={onSearch}
        value={keyword}
      />
      <label>
        <span>çŠ¶æ€</span>
        <Select defaultValue="å…¨éƒ¨" onChange={onStatusChange} value={status}>
          <Option value="">å…¨éƒ¨</Option>
          <Option value="1">çŠ¶æ€1</Option>
          <Option value="2">çŠ¶æ€2</Option>
        </Select>
      </label>
      <Table {...tableProps}></Table>
      <Pagination current={current} total={total} onChange={onChangePage} />
    </div>
  );
};
```

ä¸Šä¾‹æ¯ä¸€ä¸ª value éƒ½å¯¹åº”ç€ä¸€ä¸ª state (`keyword`ã€`status`ã€`current`ã€`total`)å’Œä¸€ä¸ªç»´æŠ¤ state çš„å›è°ƒå‡½æ•°(`onChangeKeyword`ã€`onSearch`ã€`onStatusChange`ï¼Œ`onChangePage`)ï¼Œå“ªæ€•ä½ å·²ç»ä¸¥æ ¼æŒ‰ç…§å¼€å‘è§„èŒƒå°†ä»–ä»¬æŒ‰é¡ºåºæ’åˆ—çš„ç¨³ç¨³å½“å½“ï¼Œä½†ç›¸åŒé¢†åŸŸçš„ä»£ç é€»è¾‘åœ¨ä¸€ä¸ªçºµå‘ç©ºé—´é‡Œä»ç„¶æ˜¯æ•£è½çš„ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­å…³æ³¨ç‚¹éœ€è¦ä¸æ–­çš„ä¸Šä¸‹è½¬æ¢ã€‚

![image.png](https://i.loli.net/2021/06/30/n1xgzQRaGirWhAl.png)

ä¸Šé¢æ˜¯é’ˆå¯¹ä¸Šé¢çš„ç®€ç‰ˆä¼ªä»£ç ç”»çš„å…³æ³¨ç‚¹è‰å›¾ï¼Œé»„è‰²æ˜¯ keyword ç›¸å…³çš„é€»è¾‘ï¼Œå¯ä»¥çœ‹åˆ°æ”¹åŠ¨ä¸€ä¸ªå°å°çš„ keyword å°±å¤Ÿæˆ‘ä»¬åœ¨ä»£ç é‡Œä¸Šä¸‹æ¥å›åˆ‡æ¢å¥½å‡ éã€‚å˜é‡å¤šèµ·æ¥ï¼ˆå¸¸æ€ï¼‰å°±ç›´æ¥å¬å”¤ ğŸŒˆ äº†ï¼š

![image.png](https://i.loli.net/2021/06/30/v1QHeaM6U3RD8pT.png)

æˆ‘æ„¿ç§°ä¹‹ä¸º**å…³æ³¨ç‚¹çš„ä¸Šä¸‹æ¨ªè·³**ã€‚

å°±è¿™è¿˜æ²¡æåç»­æ˜ å°„åˆ° redux çš„é“¾è·¯ï¼Œç»è¿‡â€œé‡å­å åŠ â€åç®€ç›´æ˜¯â€œåˆè‡­åˆé•¿â€ï¼Œä¸Šè¿°ä¾‹å­çš„åˆ‡æ¢æ¬¡æ•°éœ€è¦**ä¹˜ä»¥å¯¹åº” redux æ–‡ä»¶çš„æ•°ç›®**ã€‚

**å¯ä»¥çœ‹åˆ°ï¼Œredux åœ¨æˆ‘ä»¬è¿™ä¸ªåº”ç”¨ä¸­æ˜¯ä¸ªä¼ªå‘½é¢˜ï¼Œä¹‹å‰å®Œå…¨æ˜¯ç”¨ redux è§„å®šçš„è·¯æ•°ç…§æœ¬å®£ç§‘çš„æœºæ¢°å¼çš„å®Œæˆä»»åŠ¡ï¼Œæ¯ä¸ªè·¯ç”±çš„æ•°æ®ç»è¿‡ hot replace åå¹¶ä¸æ˜¯å®æ—¶å…±äº«å…±ç”¨çš„ã€‚**

å¦¥å¦¥çš„æ€é¸¡ç”¨ç‰›åˆ€ï¼Œ**å¹¶ä¸”è¿˜ç”¨äº†æ€ç‰›çš„åŠ›**ã€‚

#### åˆ«äº†ï¼Œredux

Redux çš„åˆ›é€ è€… Dan Abramov æ›¾æ›°ï¼š

> "åªæœ‰é‡åˆ° React å®åœ¨è§£å†³ä¸äº†çš„é—®é¢˜ï¼Œä½ æ‰éœ€è¦ Redux ã€‚"

ç»è¿‡ä¸Šé¢çš„â€œæ§è¯‰â€ï¼Œè¿™ç§ç®€å•çš„åœºæ™¯è¿˜éœ€è¦å¤šè¯´å•¥å—ï¼Ÿ

å¤šè¯´æ— ç›Šï¼Œåˆ«äº†ï¼Œreduxã€‚

é‚£ä¹ˆä½•æ—¶æˆ‘è®¤ä¸ºéœ€è¦ç”¨åˆ° redux å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå½“ä¸šåŠ¡åœºæ™¯æˆé•¿åˆ°éœ€è¦ redux çš„æ—¶å€™å®ƒä¼šè‡ªç„¶è€Œç„¶çš„å‡ºç°ï¼Œæ¯”å¦‚è¿™ä¸ªè¡¨æ ¼éœ€è¦æ”¯æŒ redo/undo åŠŸèƒ½ï¼Œæ¯”å¦‚è¡¨æ ¼æ•°æ®éœ€è¦åœ¨å¾ˆå¤šä¸ªä¸åŒå±‚çº§çš„åœ°æ–¹å¤ç”¨ã€‚

#### å…³æ³¨ç‚¹çš„ä¸€äº›æ€è€ƒ

æƒ³è¦å®Œå…¨åšåˆ°å…³æ³¨ç‚¹åˆ†ç¦»æ˜¯ä¸ç°å®çš„ï¼Œæˆ‘ä»¬ä¸å¯èƒ½åƒå†™æ–‡ç« ä¸€æ ·ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æŠŠæˆ‘ä»¬çš„ä»£ç æ’¸å®Œï¼Œä½†æœ‰å¾ˆå¤šåŠæ³•å¯ä»¥åšåˆ°ä¼˜é›…ï¼š

1. é¢†åŸŸåˆ’åˆ†åˆç†åŒ–
2. ç»„ä»¶åŒ–
3. å…¬å…±é€»è¾‘æå–å¤ç”¨

æ€»ç»“èµ·æ¥æœ‰ä¸¤ä¸ªæ–¹å‘ï¼š

1. è®©å˜é‡ã€æ–¹æ³•ã€é€»è¾‘æ‹¥æœ‰æœ‰åˆç†çš„ç»„ç»‡å½¢å¼ï¼Œåœ¨ä»–ä»¬è¯¥åœ¨çš„åœ°æ–¹
2. ç®€å•æˆ–å¤æ‚çš„å¤ç”¨ä»£ç è¿›è¡ŒæŠ½è±¡æ”¾å…¥é»‘ç›’ï¼Œé€šè¿‡æ¥å£è°ƒç”¨ï¼Œè°ƒç”¨æ–¹æ— éœ€å…³å¿ƒå…·ä½“å†…åœ¨å®ç°

æ˜¯ä¸æ˜¯å¾ˆåƒé¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Ÿè½å®åˆ°ç°åœ¨çš„è¡¨æ ¼ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ€è€ƒä»¥ä¸‹æ”¹è¿›æ–¹å‘ï¼š

1. **ä¸å˜çš„éƒ¨åˆ†**ï¼Œè¿›è¡Œå¼‚æ­¥è¯·æ±‚çš„çŠ¶æ€å’Œç‰¹æ€§å°è£…ï¼š

   - åŠ è½½çŠ¶æ€å’Œæ•°æ®å®ä½“çš„æŒæœ‰
   - è½®è¯¢/é˜²æŠ–/èŠ‚æµ/å¹¶è¡Œç­‰åœºæ™¯çš„å®ç°
   - é”™è¯¯çš„å¤„ç†
   - è¯·æ±‚ç¼“å­˜
   - åˆ†é¡µè¯·æ±‚ç›¸å…³å¦‚ pageIndex/pageSize/totalï¼Œåˆ‡æ¢åˆ†é¡µé‡æ–°æ‰§è¡Œè¯·æ±‚çš„æ–¹æ³•

   è¿™äº›å®Œå…¨å¯ä»¥å¤ç”¨çš„æ•°æ®ã€çŠ¶æ€ã€æ–¹æ³•å®Œå…¨å¯ä»¥æ”¾åœ¨ä¸€èµ·è¿›è¡Œç»´æŠ¤ï¼Œåˆ©ç”¨ hooks çš„èƒ½åŠ›â€œå‹¾å…¥â€æˆ‘ä»¬çš„é¡µé¢ä»£ç 

2. **å˜åŠ¨çš„éƒ¨åˆ†**ï¼Œçµæ´»æ€§å¼ºçš„éœ€æ±‚å¦‚è¡¨æ ¼é¡¶éƒ¨çš„å®é™…æ“ä½œåŒºåŸŸï¼Œå¯ä»¥ç”¨ä¸€ç§å·²ç»å­˜åœ¨çš„å¤©ç„¶å®¹å™¨æ¡†æŸ±å®ƒï¼Œæ”¶æŸç»„ç»‡å½¢å¼çš„åŒæ—¶æä¾›å¥å…¨çš„èƒ½åŠ›ï¼Œå¹¶ç»Ÿä¸€æäº¤æ–¹å¼ã€‚è¿™ä¸ªå®¹å™¨å°±æ˜¯ Antd Formã€‚

3. æŠŠ 1 å’Œ 2 è”ç»“èµ·æ¥

### ç°æˆè½®å­<a id="3.3"></a>

å¼€æºä¸–ç•Œé‡Œï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šçœºæœ›é£æ™¯æ˜¯æœ€èªæ˜çš„åšæ³•ã€‚

å¯¹äºå¼‚æ­¥è¯·æ±‚ï¼Œæˆ‘ä»¬é‡‡ç”¨ SWR ç­–ç•¥ï¼Œ`useSWR` hook å¯è°“æ·±å…¥äººå¿ƒã€‚

å‚è€ƒåœ°å€ï¼š[SWR ç”¨äºæ•°æ®è¯·æ±‚çš„ React Hooks åº“](https://swr.vercel.app/zh-CN)

è¿™æ¬¡é€‰ç”¨çš„æ˜¯åŸºäº`useSWR`å®ç°çš„æ›´å¼ºå¤§åŠŸèƒ½ä¹Ÿæ›´ä¸°å¯Œçš„ hooks å·¥å…·é›†â€”â€”[ahooks](https://ahooks.js.org/zh-CN/docs/getting-started)ã€‚

å®ƒç”±é˜¿é‡Œçš„ umi å’Œ ice å›¢é˜Ÿç»´æŠ¤ï¼Œä¸ä»…ä»…æœ‰å°è£…äº† SWR èƒ½åŠ›çš„`useRequest`hookï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šå®ç”¨çš„ hooksã€‚

é€šè¿‡`useRequest`ï¼Œä»¥ä¸‹å‡ è¡Œä»£ç å³å¯å®Œæˆä¸€ä¸ªè¡¨æ ¼çš„æœ€å°é—­ç¯ï¼š

```typescript
import { useRequest } from 'ahooks';
import { Table } from 'antd';

// æ¨¡æ‹Ÿè¯·æ±‚
function getUserList(): Promise<any[]> {
  return new Promise((resolve) => {
    setTimeout(() => {
      resolve([
        // ...
      ]);
    }, 1000);
  });
}

function PageA() {
  // çŠ¶æ€æŒæœ‰ï¼ˆdataã€errorã€loadingç­‰ï¼‰
  // è‡ªåŠ¨å‘é€è¯·æ±‚ï¼ˆå¯é€šè¿‡ manual: true é…ç½®æ‰‹åŠ¨ï¼‰
  const { data, error, loading } = useRequest(getUserList, {
    throttleInterval: 1000, // èŠ‚æµé—´éš”
  });

  const columns = [
    // ...
  ];

  if (error) return <div>failed to load</div>;
  return (
    <Table
      columns={columns}
      dataSource={data}
      loading={loading}
    />;
  )
}
```

### è¿›ä¸€æ­¥æŠ½è±¡<a id="3.4"></a>

å¯¹äºåˆšæ‰æåˆ°çš„è¡¨æ ¼ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨`useRequest`ç»“åˆ Antd Form çš„èƒ½åŠ›åˆæ­¥å°è£…æˆä¸€ä¸ªä¸šåŠ¡ç»„ä»¶ï¼ŒæŒ‰ç…§åœºæ™¯å–åä¸º`useAntdTable`ï¼ˆPowered by [ahooks useAntdTable](https://ahooks.js.org/zh-CN/hooks/table/use-antd-table)ï¼‰ã€‚

æŒ‰ç…§ Antd 4 çš„ Form å†™æ³•ï¼Œæˆ‘ä»¬éœ€è¦å¾€ hook é‡Œä¼ å…¥ä¸€ä¸ª `useForm()` ä¹‹åçš„ `form` å®ä¾‹é…ç½®é¡¹ã€‚

ä¼ªä»£ç ï¼š

```typescript
export function useAntdTable(
  service, // æŒ‰ç…§æ ¼å¼è¦æ±‚å°è£…åçš„å¼‚æ­¥è¯·æ±‚
  options // é…ç½®å¯¹è±¡
) {
  // 1. æ ¹æ®serviceåˆå§‹åŒ–è¯·æ±‚ useRequest(service, ...)å¹¶æ‹¿åˆ°result
  // 2. åˆå§‹åŒ–formå®ä¾‹ç›¸å…³æ•°æ®å’Œæ“ä½œï¼ŒåŒ…æ‹¬submitæäº¤ã€reseté‡ç½®ã€validateæ ¡éªŒ
  // 3. å¤„ç†é¦–æ¬¡æäº¤è¯·æ±‚
  // 4. è¿”å›éœ€è¦çš„å˜é‡
}
```

åŠ ä¸Šäº¿ç‚¹ç‚¹ç»†èŠ‚ï¼ˆå‡å°‘é•¿åº¦è¿™é‡Œå¿½ç•¥ ts)ï¼š

```typescript
export function useAntdTable(
  service, // æŒ‰ç…§æ ¼å¼è¦æ±‚å°è£…åçš„å¼‚æ­¥è¯·æ±‚
  options // é…ç½®å¯¹è±¡
) {
  // é…ç½®é¡¹è§£æ„
  const {
    form, // Antd Form å®ä¾‹
    refreshDeps = [], // æ›´æ–°ä¾èµ–é¡¹
    manual, // æ˜¯å¦æ‰‹åŠ¨æ§åˆ¶
    defaultParams, // é»˜è®¤å‚æ•°
    ...restOptions // å…¶å®ƒé…ç½®é¡¹
  } = options;
  const result = useRequest(service, {
    ...restOptions,
    paginated: true, // é»˜è®¤åˆ†é¡µå–
    manual: true, // requestæ§åˆ¶æƒå¿…é¡»äº¤åˆ°è¿™å±‚
  });
  // tablePropsæ˜¯useRequesté’ˆå¯¹Tableåœºæ™¯ç‰¹åˆ«æ”¯æŒçš„è¿”å›å¯¹è±¡
  const { params, run, tableProps } = result;
  // åˆå§‹åŒ–å…¨é‡formæ•°æ®
  const [allFormData, setAllFormData] = useState({});
  const formRef = useRef(form);
  formRef.current = form;
  // åˆå§‹åŒ–
  useEffect(() => {
    if (!formRef.current) {
      return;
    }
    formRef.current.setFieldsValue(allFormData);
  }, []);

  // è·å–å½“å‰å±•ç¤ºçš„ form å­—æ®µå€¼
  const getActiveFieldValues = useCallback(() => {
    if (!form) {
      return {};
    }
    return form.getFieldsValue(null, () => true);
  }, [form]);

  // é¦–æ¬¡åŠ è½½ï¼Œæ‰‹åŠ¨æäº¤ã€‚ä¸ºäº†æ‹¿åˆ° form çš„ initial values
  useEffect(() => {
    // å¦‚æœæœ‰ç¼“å­˜åˆ™ä½¿ç”¨ç¼“å­˜é‡æ–°è¯·æ±‚
    if (params.length > 0) {
      run(...params);
      return;
    }

    // å¦‚æœæ²¡æœ‰ç¼“å­˜ä¸”éæ‰‹åŠ¨æ§åˆ¶è‡ªåŠ¨è§¦å‘ submit
    if (!manual) {
      _submit(defaultParams);
    }
  }, []);

  // è¡¨å•æ ¡éªŒæ–¹æ³•
  const validateFields = useCallback(() => {
    // å–å€¼
    const fieldValues = getActiveFieldValues();
    // æ²¡æœ‰formç›´æ¥æ”¾è¡Œ
    if (!form) {
      return Promise.resolve();
    }

    const fields = Object.keys(fieldValues);
    return form.validateFields(fields);
  }, [form]);

  // ç§æœ‰æäº¤æ–¹æ³•
  const _submit = useCallback(
    (initParams) => {
      setTimeout(() => {
        validateFields()
          .then(() => {
            const activeFormData = getActiveFieldValues();
            // è®°å½•å…¨é‡æ•°æ®
            const _allFormData = { ...allFormData, ...activeFormData };
            setAllFormData(_allFormData);
            // æœ‰é»˜è®¤å‚æ•°
            if (initParams) {
              run(initParams[0], activeFormData, {
                allFormData: _allFormData,
              });
              return;
            }
            run(
              {
                pageSize: options.defaultPageSize || 10,
                ...(params[0] || {}), // é˜²æ­¢ manual æƒ…å†µä¸‹ï¼Œç¬¬ä¸€æ¬¡è§¦å‘ submitï¼Œæ­¤æ—¶æ²¡æœ‰ params[0]
                current: 1,
              },
              activeFormData,
              {
                allFormData: _allFormData,
              }
            );
          })
          .catch((err) => err);
      });
    },
    [getActiveFieldValues, run, params, allFormData]
  );
  // å¾€å¤–æš´éœ²çš„formæäº¤æ–¹æ³•
  const submit = usePersistFn((e) => {
    // é˜»æ­¢é»˜è®¤äº‹ä»¶
    if (e && e.preventDefault) {
      e.preventDefault();
    }
    _submit();
  });
  // è¡¨å•é‡ç½®æ–¹æ³•
  const reset = useCallback(() => {
    if (form) {
      form.resetFields();
    }
    _submit();
  }, [form, _submit]);

  // æ ¹æ®ç”¨æˆ·é…ç½®çš„refreshDepsé‡ç½®è¡¨å•
  useUpdateEffect(() => {
    if (!manual) {
      resetPersistFn();
    }
  }, [...refreshDeps]);

  // æš´éœ²api
  return {
    ...result,
    // searchç”¨äºè¡¨å•ç›¸å…³æ“ä½œ
    search: {
      submit,
      reset,
    },
  };
}
```

#### ä½¿ç”¨ useAntdTable è¿›è¡Œé¡¹ç›®æ”¹é€ 

è¿˜ä¸¾è¿™ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š

![image.png](https://i.loli.net/2021/06/28/cYZQs3trPmpgkOH.png)

**é¦–å…ˆæˆ‘ä»¬åœ¨ä»£ç é‡Œå¹²æ‰ redux ç›¸å…³çš„ä»£ç **ã€‚

##### ä¸å˜çš„éƒ¨åˆ†

å‰é¢`useRequest`çš„æœ€å°é—­ç¯å·²ç»æ¼”ç¤ºäº†éƒ¨åˆ†å¨åŠ›ï¼Œè¿™é‡Œä¹Ÿå…ˆåˆ¨é™¤é¡¶éƒ¨ Form çš„å½±å“ï¼Œå…ˆå¯¹ typescript å’Œ pagination ç›¸å…³çš„é€»è¾‘åšä¸€äº›è¡¥å……ï¼š

```typescript
// ...
// PaginatedParams åˆ†é¡µå‚æ•°ç±»å‹
import useAntdTable, {
  PaginatedParams,
  usePersistFn,
} from 'src/hooks/useAntdTable';
// è¡¨æ ¼å±•ç¤ºç»„ä»¶
const ActivityList: React.FC = () => {
  // ...
  // è¡¨æ ¼è¯·æ±‚å°è£…
  // usePersistFn ahooksæä¾›ï¼Œç”¨äºæŒä¹…åŒ– functionï¼Œä½œç”¨åŒäº useCallbackï¼Œå…äºæ¯æ¬¡éƒ½åˆ›å»ºç›¸åŒå‡½æ•°ï¼ˆå¯é€‰ï¼‰
  const getTableData = usePersistFn(
    ({ current, pageSize }: PaginatedParams[0]) => {
      // å®é™…è°ƒç”¨apiæ–¹æ³•
      return getActivityList({
        page: current,
        page_size: pageSize,
      });
    }
  );

  /* è¡¨æ ¼å¯¹è±¡ç›¸å…³
    tableProps: {
      dataSource: SignUpDeveloperListItem[];
      loading: boolean;
      onChange: (pagination: PaginationConfig, filters?: any, sorter?: any) => void;
      pagination: PaginationConfig;
    } 
    paginationConfig: {
      total?: number;
      current?: number;
      pageSize?: number;
      onChange?: (page: number, pageSize?: number) => void;
      ...
    }
  */
  // run æš´éœ²çš„å†…éƒ¨é‡æ–°è°ƒç”¨è¡¨æ ¼è¯·æ±‚çš„æ‰‹åŠ¨æ‰§è¡Œæ–¹æ³•
  // error æ˜¯å¦æŠ›å‡ºé”™è¯¯
  const { tableProps, run, error } = useAntdTable<
    ActivityList, // å®é™…è¯·æ±‚ç±»å‹
    ActivityListItem // è¡¨æ ¼dataSource itemç±»å‹
  >(getTableData, {
    // é»˜è®¤è¯·æ±‚å‚æ•°
    defaultParams: [{ current: 1, pageSize: 10 }],
    // å¯¹æ¥å£æ•°æ®è¿›è¡Œæ ¡æ­£æ»¡è¶³å†…éƒ¨æ ¼å¼è¦æ±‚
    formatResult(data) {
      return {
        total: data.total_count,
        list: data.list,
      };
    },
  });

  // ...
  const columns: TableColumnsType<ActivityListItem> = [
    // ...
  ];

  if (error) {
    return <div>failed to load</div>;
  }
  return (
    <Table
      rowKey="uid"
      columns={columns}
      // é€šè¿‡å¯¹è±¡è§£æèµ‹å€¼æŠŠæ‰€æœ‰å±æ€§ä¸€æ¬¡èµ‹é½
      {...tableProps}
      // ç›¸å½“äºä¼ å¦‚å…¥
      // dataSource={tableProps.dataSource}
      // pagination={{
      //   current: tableProps.pagination.current,
      //   pageSize: tableProps.pagination.pageSize,
      //   total: tableProps.pagination.total,
      // }}
      // loading={tableProps.loading}
    />
  );
};
```

æ­¤æ—¶çš„å¿ƒæ™ºè´Ÿæ‹…éª¤å‡ä¸ºï¼š

1. ç†Ÿæ‚‰`useAntdTable`çš„å‚æ•°ç±»å‹å’Œè¿”å›å¯¹è±¡çš„è¿ç”¨ï¼Œå¯é€šè¿‡æŸ¥çœ‹æ–‡æ¡£å’Œ ts æ³¨é‡Šå¸®åŠ©ç†è§£
2. ç®€å•æ„é€ ä¸‹`useAntdTable`çš„ç¬¬ä¸€ä¸ªè¯·æ±‚ service æ–¹æ³•

æ€»ç»“ä¸‹ï¼šæ»¡è¶³`useAntdTable`çš„è°ƒç”¨è§„èŒƒå’Œç±»å‹è§„èŒƒï¼Œå‰©ä¸‹çš„è„æ´»ç´¯æ´»äº¤ç»™å®ƒï¼ˆå¹¶ä¸”æ‹¥æœ‰å®Œæ•´çš„`useRequest`èƒ½åŠ›ï¼‰ã€‚

##### å˜åŠ¨çš„éƒ¨åˆ†

é’ˆå¯¹å¤´é¡¶éƒ¨åˆ†ä¸å®šçš„ Form éƒ¨åˆ†ï¼Œ`useAntdTable`ä¸»è¦å›´ç»•`Form.useForm()`åˆ›å»ºçš„`form`å®ä¾‹åšäº†ä¸€å±‚å°è£…ï¼Œè®©ä½ ä¸å†éœ€è¦å…³æ³¨ form çš„ valuesï¼Œåªéœ€è¦å»ç»„ç»‡ä½ éœ€è¦çš„è¡¨å•æ§ä»¶å±•ç¤ºå³å¯ï¼š

```typescript
import useAntdTable, {
  PaginatedParams,
  usePersistFn,
  useCreation,
} from 'src/hooks/useAntdTable';
// è¡¨æ ¼å±•ç¤ºç»„ä»¶
const ActivityList: React.FC = () => {
  // ...
  // åˆ›å»ºformå®ä¾‹ï¼ˆå¿…è¦ï¼‰
  // SearchFormParamsType è¡¨å•ç±»å‹æ¥å£
  const [form] = Form.useForm<SearchFormParamsType>();
  // è¡¨æ ¼è¯·æ±‚å°è£…ï¼ˆç•¥ï¼‰
  const getTableData = usePersistFn(() => {});

  // æ³¨æ„è¿™é‡Œå¤šå‡ºçš„search
  const { tableProps, error, search } = useAntdTable<
    ActivityList, // å®é™…è¯·æ±‚ç±»å‹
    ActivityListItem // è¡¨æ ¼dataSource itemç±»å‹
  >(getTableData, {
    // é»˜è®¤è¯·æ±‚å‚æ•°
    defaultParams: [{ current: 1, pageSize: 10 }],
    // å¯¹æ¥å£æ•°æ®è¿›è¡Œæ ¡æ­£æ»¡è¶³å†…éƒ¨æ ¼å¼è¦æ±‚ï¼ˆç•¥ï¼‰
    formatResult(data) {},
  });

  // submitï¼š form æäº¤å›è°ƒæ–¹æ³•
  // resetï¼š form é‡ç½®å›è°ƒæ–¹æ³•
  const { submit, reset } = search;

  //...
  // å®é™…å¤´éƒ¨Formå±•ç¤ºç»„ä»¶
  // useCreation ahooksæä¾›ï¼Œç”¨äºç¼“å­˜memoå’Œrefï¼Œæ˜¯useMemoå’ŒuseRefçš„æ›¿ä»£å“ï¼Œå…äºæ¯æ¬¡éƒ½åˆ›å»ºç›¸åŒå‡½æ•°ï¼ˆå¯é€‰ï¼‰
  const SearchForm = useCreation(() => {
    return (
      <div>
        <Form form={form} layout="inline">
          <Form.Item name="keyword">
            <Input
              placeholder="è¯·è¾“å…¥æ´»åŠ¨åç§°æˆ–id"
              onPressEnter={submit} // å›è½¦è°ƒç”¨submitè¿›è¡Œé‡æ–°è¯·æ±‚
              allowClear
            />
          </Form.Item>
          <Form.Item label="æ´»åŠ¨çŠ¶æ€" name="isClose" initialValue="">
            <Select
              disabled={loading}
              style={{ width: 120 }}
              onChange={submit} // ä¸‹æ‹‰æ¡†å˜åŒ–è°ƒç”¨submitè¿›è¡Œé‡æ–°è¯·æ±‚
              options={activityStatusSelect}
            />
          </Form.Item>
          <Form.Item label="æ´»åŠ¨ç±»å‹" name="type" initialValue="">
            <Select
              disabled={loading}
              style={{ width: 120 }}
              onChange={submit}
              options={activityTypeSelect}
            />
          </Form.Item>
          <Form.Item>
            <Space>
              <Button
                type="primary"
                icon={<SearchOutlined />}
                disabled={loading}
                onClick={submit}
              >
                æœç´¢
              </Button>
              {isAllowedAddBusiness && (
                <Button
                  type="primary"
                  icon={<PlusCircleOutlined />}
                  disabled={loading}
                  onClick={onAdd}
                >
                  æ–°å¢
                </Button>
              )}
            </Space>
          </Form.Item>
        </Form>
      </div>
    );
  }, [form, loading, submit]);

  if (error) {
    return <div>failed to load</div>;
  }
  return (
    <>
      // æ“ä½œåŒºåŸŸåµŒå…¥è¡¨æ ¼å¤´éƒ¨
      {SearchForm}
      <Table rowKey="uid" columns={columns} {...tableProps} />
    </>
  );
};
```

è¿™æ—¶æ–°å¢çš„å¿ƒæ™ºè´Ÿæ‹…ï¼š

1. é€šè¿‡`useForm`åˆ›å»º Antd form å®ä¾‹å¹¶ä¼ å…¥
2. ç®€å•ç»´æŠ¤ Form ç»“æ„ï¼Œç”¨`Form.Item`åŒ…è£¹ä¸€å±‚ç»„ä»¶

#### æ•°æ®çªå˜

æŒ‰ç…§å½“å‰çš„å®è·µæ¨è¿›ä»£ç ä¸€åˆ‡éƒ½å¾ˆé¡ºåˆ©ï¼Œä½†å¾ˆå¿«å°±é‡åˆ°äº†ä¸€ä¸ªæ–°é—®é¢˜ã€‚

ç”±äºæ­¤æ—¶æˆ‘ä»¬ Table çš„ dataSource æ§åˆ¶æƒå®Œå…¨äº¤ç»™äº† `useAntTable`ï¼Œä¹Ÿå°±æ˜¯`tableProps.dataSource`ï¼Œé‚£å²‚ä¸æ˜¯ä»£è¡¨æ¯æ¬¡éœ€è¦æ›´æ–° table æ•°æ®ï¼Œéƒ½å¾—`run`æˆ–è€…`submit`æ‰è¡Œï¼Ÿè¦æ˜¯æˆ‘å°±æ˜¯ä¸æƒ³é‡æ–°è¯·æ±‚å‘¢ï¼Ÿ

æ¯”å¦‚æ‹–æ‹½è¡¨æ ¼çš„è¡Œè¿›è¡Œæ’åºï¼Œç»“æŸåä¸æƒ³è¿›è¡Œè¡¨æ ¼è¯·æ±‚åˆ·æ–°å´è¦æ±‚è§†å›¾æ›´æ–°è¿™ä¸ªå¸¸è§åœºæ™¯ã€‚

å…¶å®`useRequest`æœ‰è§£å†³è¿™ä¸ªåœºæ™¯çš„æ–¹æ¡ˆï¼Œé‚£ä¾¿æ˜¯å†…éƒ¨æš´éœ²çš„`mutate`çªå˜æ–¹æ³•ï¼š

```typescript
// data ç±»æ¯” tableProps.dataSourceï¼Œæ§åˆ¶æƒåœ¨useRequest
const { data, mutate } = useRequest(getSomething);

// é€šè¿‡changeDataæ–¹æ³•è°ƒç”¨mutateå®Œæˆdataçš„å˜åŒ–
const changeData = () => {
  mutate({
    foo: '1',
    bar: '2
  })
}
```

`useAntdTable`çš„æºç å†…éƒ¨å®ç°ä¹Ÿæ˜¯è°ƒç”¨çš„`useRequest`çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å¾€å¤–é€ä¼ äº†`mutate`æ–¹æ³•ï¼š

```typescript
// æ”¹åŠ¨éƒ¨åˆ†
// ...
const { tableProps, mutate } = useAntdTable(getTableData);

// ...
return (
  <Table
    // ...
    {...tableProps}
    onChange={(state) => mutate(state)} // å˜åŠ¨åæ‰§è¡Œmutateå®Œæˆè§†å›¾æ›´æ–°
  />
);
```

#### æ€»ç»“

ä»¥ä¸Šç®€è¦ä»‹ç»äº†ä¸‹ç”¨`useAntTable` hook è¿›è¡Œæ”¹é€ å¸¦æ¥çš„ç«‹ç«¿è§å½±çš„æ•ˆæœï¼Œå®ƒèƒ½å¦‚æ­¤ç¨‹åº¦çš„ç²¾ç®€ä»£ç ï¼Œå®é™…å°±æ˜¯æ¯”è¾ƒå¥½çš„è·µè¡Œäº†ä¸Šé¢æ‰€è¯´çš„ä¸‰ä¸ªç‚¹ï¼š

1. é¢†åŸŸåˆ’åˆ†åˆç†åŒ–
2. ç»„ä»¶åŒ–
3. å…¬å…±é€»è¾‘æå–å¤ç”¨

#### ç»ˆæå±•æœ›

å½“ç„¶è¿™ä¸ªè¡¨æ ¼åœºæ™¯æœ€ç»ˆæçš„æŠ½è±¡åº”è¯¥æ˜¯**æ— é™è¶‹è¿‘é›¶ä»£ç çš„ä½ä»£ç **ã€‚

è¿™å°±æ¶‰åŠåˆ°äº†å‰åç«¯ Schemaã€Fieldã€Record ç­‰çš„å®šä¹‰ä¸€è‡´æ€§å’ŒåŒæ­¥æŠ½è±¡ï¼Œåœ¨è¿™ä¸ªå‰æä¸‹è¡¨æ ¼çš„ Columns ç”±å®šä¹‰å¥½çš„æ§ä»¶ä½“ç³»ç»„æˆï¼Œä½¿ç”¨æ–¹å¯ä»¥ä»»æ„è®¾è®¡å±äºè‡ªå·±ä¸šåŠ¡å½¢æ€çš„è¡¨æ ¼ï¼Œè¡¨æ ¼çš„æ¯ä¸ª Row éƒ½å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¡¨å•ï¼ˆRecordï¼‰ï¼Œæ— è®ºæ˜¯ç›´æ¥åœ¨å•å…ƒæ ¼å½•å…¥è¿˜æ˜¯å¡«å†™å¤–é“¾è¡¨å•ï¼Œéƒ½æ˜¯åœ¨æ„é€ è¿™ä¸ªè¡¨æ ¼çš„æ•°æ®ï¼Œè€Œä¸æ˜¯ç”±åå°æ ¹æ®éœ€æ±‚ç»„è£…å¥½å¸¦å‡ºçš„æ­»æ•°æ®ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å®ç°äº†ä¸€ä¸ªå®Œå…¨çš„æ§åˆ¶åè½¬ã€‚

è¿™ä¸ªè¯é¢˜å±•å¼€èµ·æ¥å°±æœ‰ç‚¹é•¿äº†ï¼Œä»¥åæœ‰èƒ½åŠ›æœ‰æœºä¼šå†å•ç‹¬å†™ä¸€ç¯‡å…³äºè¿™æ–¹é¢çš„ç†è§£ã€‚

å¸‚é¢ä¸Šçš„ä½ä»£ç å¹³å°æœ‰ AirTableã€æœ‰æ ¼ã€ç»´æ ¼è¡¨ç­‰ç­‰ï¼Œæœ‰å…´è¶£å¯ä»¥åº·åº·ã€‚

### è·¯ç”±ç¼“å­˜<a id="3.5"></a>

vue-router æœ‰å¼€ç®±å³ç”¨çš„ Keep-Alive ç»„ä»¶ï¼Œå¯ä»¥æ–¹ä¾¿çš„å®ç°è·¯ç”±ç¼“å­˜åŠŸèƒ½ï¼Œå³è®¾ç½®ç¼“å­˜çš„è·¯ç”±åˆ‡æ¢ä¹‹åç›´æ¥æ‹¿ä¹‹å‰æ¸²æŸ“è¿‡çš„é¡µé¢å®ä¾‹è¿›è¡Œæ¸²æŸ“ï¼Œè¿™åœ¨æŸäº›åœºæ™¯éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä¸€ä¸ªåˆ†é¡µé•¿åˆ—è¡¨è¿›å…¥è¯¦æƒ…é¡µå†å›æ¥ï¼Œç”¨æˆ·è‚¯å®šæ˜¯ä¸å¸Œæœ›é¡µé¢åˆ·æ–°å›é€€ä¸¢å¤±æ»šåŠ¨è¿›åº¦å¹¶ä¸”å›åˆ°ç¬¬ 1 é¡µçš„ã€‚

ä½†æ˜¯ react-router å¹¶æ²¡æœ‰æä¾›è¿™ä¸ªåŠŸèƒ½ï¼Œå› ä¸ºå®˜æ–¹è§‰å¾—è¿™æœ‰å†…å­˜æ³„æ¼çš„é£é™©ï¼Œæ‰€ä»¥è·¯å¾„ä¸åŒ¹é…æ—¶ä¼šé€‰æ‹©ç›´æ¥æŠŠå¯¹åº”ç»„ä»¶å¸è½½å¹¶ä» dom ä¸­åˆ é™¤ã€‚

ä¸Šæœ‰æ”¿ç­–ä¸‹æœ‰å¯¹ç­–ï¼Œå®é™…ä¸Šåªè¦æ§åˆ¶å¾—å½“ï¼Œå†…å­˜æ³„æ¼æ˜¯ä¸å­˜åœ¨çš„~æŸ¥æ‰¾å®Œè§£å†³æ–¹æ¡ˆåï¼Œå‘ç° react-router çš„æºç é‡Œ`children`å¯ä»¥æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å¸®åŠ©æ‰‹åŠ¨æ§åˆ¶æ¸²æŸ“è¡Œä¸ºï¼Œé‚£ä¹ˆæ­¤æ—¶**ç”¨éšè—æ›¿æ¢åˆ é™¤**å²‚ä¸å°±å®ç°äº†ç®€å•çš„ Keep-Alive åŠŸèƒ½ï¼Ÿ

![image.png](https://i.loli.net/2021/06/30/AjyHTaM9Lqbwtfe.png)

å°è¯•äº†ä¸€ä¸‹ä¹‹åå‘ç°æœ‰å¾ˆå¤šå·¥ä½œè¦åšï¼Œæ—¶é—´ä¸Šä¸å…è®¸ï¼Œä½†å¥½åœ¨æ€è·¯éƒ½æ˜¯ç›¸åŒçš„ï¼Œäºæ˜¯é€‰æ‹©äº†[react-router-cache-route](https://github.com/CJY0208/react-router-cache-route)è¿™ä¸ªå¼€æºå·¥å…·å®Œæˆäº†è·¯ç”±ç¼“å­˜çš„åŠŸèƒ½ï¼Œè¿è¡Œè‰¯å¥½ã€‚

è·¯ç”±ç›¸å…³è®¾ç½®ä¿®æ”¹ï¼š

![image.png](https://i.loli.net/2021/07/01/OJmqFjxz6lQ5cry.png)

![image.png](https://i.loli.net/2021/07/01/dvY1lynh4qrL5jT.png)

### åŠ ç‚¹å°ç©æ„å„¿<a id="3.6"></a>

å¼€å‘è¿‡ç¨‹ä¸­å‘ç°ä¸€ä¸ªéå¸¸å°çš„äº¤äº’ç»†èŠ‚ï¼šä¾‹å¦‚æ‰‹æœºå·ç ã€ç”¨æˆ·å§“åç­‰é‡è¦ä¿¡æ¯è™½ç„¶å¯ä»¥é€‰æ‹©å¤åˆ¶ï¼Œä½†ä¸å…æœ‰äº›éº»çƒ¦ï¼Œä¸ºå•¥ä¸æä¾›ä¸€é”®å¤åˆ¶çš„è´´å¿ƒæœåŠ¡å‘¢ï¼Ÿ

æ ¸å¿ƒæ€è·¯æ˜¯è°ƒç”¨`document.execCommand` apiï¼Œè¿™ç­‰æŠ•å…¥äº§å‡ºæ¯”é«˜çš„æ´»å„¿å¿…é¡»æœ‰ã€‚

```typescript
interface PropsTypes {
  /** éœ€è¦å¤åˆ¶çš„æ–‡å­— */
  text: string;
  /** æç¤ºæ–‡å­— */
  title?: string;
  /** è§¦å‘æ–¹å¼ï¼ˆåŒantd Tooltip ç»„ä»¶ï¼‰ */
  trigger?: 'click' | 'hover' | 'focus' | 'contextMenu';
}
/**
 * @description åŸºäºantdçš„Tooltipç»„ä»¶å°è£…çš„ä¸€å±‚å¯ä»¥è‡ªåŠ¨å¤åˆ¶å†…å®¹çš„ç»„ä»¶
 * @param {PropsTypes} ä¼ å‚è§PropsTypesæ¥å£æ³¨é‡Š
 * @param {React.ReactNode} children å®é™…æ˜¾ç¤ºå†…å®¹æ’æ§½
 */

const CopyTooltip: React.FC<PropsTypes> = ({
  title,
  text,
  children,
  trigger,
}) => {
  // æ˜¾ç¤ºéšè—
  const [visible, setVisible] = useState(false);
  // æ ‡é¢˜ç‚¹å‡»å›è°ƒ
  const onTitleClick = () => {
    onceFakeCopyElement(text);
    setVisible((value) => !value);
  };
  const Title = <span onClick={onTitleClick}>{title || 'ç‚¹æ­¤å¤åˆ¶'}</span>;
  if (text) {
    return (
      <Tooltip
        visible={visible}
        placement="right"
        title={Title}
        overlayInnerStyle={overlayInnerStyle}
        trigger={trigger || 'hover'}
        onVisibleChange={(value) => setVisible(value)}
      >
        {children}
      </Tooltip>
    );
  }
  return { children };
};

// åˆ›å»ºä¸€æ¬¡æ€§çš„å‚€å„¡å¤åˆ¶å…ƒç´ 
function onceFakeCopyElement(text: string) {
  const $input = document.createElement('input');
  // èµ‹å€¼
  $input.value = text;
  $input.style.position = 'fixed';
  $input.style.top = '0';
  $input.style.left = '0';
  $input.style.opacity = '0';
  document.body.appendChild($input);
  // é€‰ä¸­ä¸´æ—¶åˆ›å»ºçš„æ–‡æœ¬æ¡†
  $input.select();
  try {
    // åˆ©ç”¨ document.execCommand æ‰§è¡Œå¤åˆ¶æ“ä½œ
    const copied = document.execCommand('copy');
    if (copied) {
      message.success('å·²å¤åˆ¶åˆ°ç³»ç»Ÿå‰ªè´´æ¿');
    }
  } catch (error) {
    console.error(error);
  } finally {
    // ç”¨ååŠæ—¶åˆ é™¤å…ƒç´ 
    document.body.removeChild($input);
  }
}

export default CopyTooltip;
```

ä½¿ç”¨ï¼š

![image.png](https://i.loli.net/2021/07/01/swvAMfdnQRXCHUT.png)

æ•ˆæœå¦‚ä¸‹ï¼Œç‚¹å‡»ä¹‹åå³æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š

![image.png](https://i.loli.net/2021/07/01/dZ1WYME9G7s2Qzq.png)

### Code Spell Checker<a id="3.7"></a>

æ•²ä»£ç çš„æ—¶å€™éš¾å…å‡ºç° typoï¼Œå“ªæ€•æ‰“ä¸­æ–‡æ³¨é‡Šéƒ½å¯èƒ½å‡ºç°ä½çº§é”™è¯¯ï¼Œæ›´åˆ«æè‹±æ–‡äº†ï¼Œå¾ˆå¤šå¼€æºé¡¹ç›®ä¹Ÿå­˜åœ¨ä¸å°‘è¿™ç§æƒ…å†µã€‚

æ¯”å¦‚è¿™å‡ ä¸ªç»å…¸çš„ä¾‹å­ï¼šdevoloper/paticipants/getDataFormRemote/UersTYype/...

é€šè¿‡å®‰è£… [Code Spell Checker](https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker) è¿™ä¸ª vscode æ’ä»¶å¯ä»¥å¾ˆå¥½çš„é¿å… typoã€‚

æ•ˆæœå¦‚ä¸‹ï¼Œé”™è¯¯çš„æ‹¼å†™ä¼šä»¥è“è‰²æ³¢æµªçº¿å‘ˆç°ï¼ˆå¯é…ç½®ï¼‰ï¼š

![image.png](https://i.loli.net/2021/07/01/Caj8vtb3lPnTE7o.png)

ç‚¹å‡»å¿«é€Ÿä¿®å¤ï¼Œå¯ä»¥æŸ¥çœ‹æ¨èçš„æ­£ç¡®å•è¯å€™é€‰é¡¹ï¼Œé€‰æ‹©åä¼š**æ‰¹é‡æ›¿æ¢**ç›¸åŒçš„é”™è¯¯å•è¯ï¼›ç‚¹å‡»æœ€ä¸‹æ–¹çš„ä¸¤ä¸ªé€‰é¡¹ï¼Œå¯ä»¥æŠŠè¯¥è¯åŠ å…¥ç”¨æˆ·å’Œå½“å‰å·¥ä½œåŒºçš„ç™½åå•ï¼š

![image.png](https://i.loli.net/2021/07/01/X3c6fuSRlgoaBUq.png)

ç²¾è‡´ç å†œåˆè¿›ä¸€æ­¥ o(ï¿£ â–½ ï¿£)ï½„ã€‚

## æ€»ç»“<a id="4"></a>

æ–‡ç« å¾ˆé•¿ï¼Œè®²çš„ä¸œè¥¿å´å…¶å®å¾ˆæµ…ï¼Œä¸»è¦æ˜¯ä»¥èŒæ–°çš„è§†è§’å»èŠèŠè‡ªå·±åˆšå¼€å§‹å†™ react çš„æ„Ÿå—ï¼ŒæœŸé—´å¤šæ¬¡æƒ³æ”¾å¼ƒï¼Œå¥½åœ¨æœ€åè¿˜æ˜¯åšæŒä¸‹æ¥äº†ï¼

å¸Œæœ›èƒ½æœ‰å¯¹å¤§å®¶æœ‰ç”¨ï¼Œè€ reactor æ±‚è½»å–·...
