# Next 知识点记录

摆脱传统 CSR 的观念，即所有数据异步获取，在这之前要么白屏要么用骨架屏占位

next 最重要的概念是**预渲染（Pre-rendering）**

默认情况下，所有页面都将被提前预渲染成 HTML。每个生成的 HTML 只关联这个页面所需的最小可执行 JS 代码，当页面被浏览器加载，JS 运行并使得该界面变成可交互。**这个过程被称之为水合（hydration）**。

next 有两种预渲染的方式，两者的不同之处在于为页面生成 HTML 的时机（在开发环境中为了方便调试，强制开启 SSR），允许两种方式混合使用，可结合实际业务场景灵活选择。

- **静态页面生成 SSG（Static Side Generation）**：在构建时生成 HTML 的预渲染方法，每次请求都会返回**相同的预渲染页面**，千人一面。
- **服务端渲染 SSR (Service Side Rendering)**：每次请求**都会生成新的 HTML** 的预渲染方法，千人千面。

## SSG

SSG 不完全是静态的，可以通过在渲染页面中同级暴露一个异步 `getStaticProps` 方法根据动态数据展示界面。在构建时会自动探测执行这个方法，根据返回的异步结果做下一步的渲染。（开发环境中，每次请求都会触发）

```typescript
export default function Home(props) { ... }

export async function getStaticProps() {
  // Get external data from the file system, API, DB, etc.
  const data = ...

  // The value of the `props` key will be
  //  passed to the `Home` component
  return {
    props: ...
  }
}
```

`getStaticProps` 只会在服务端运行，只能 page 模块中页面中导出。

## SSR

SSR 中取代 `getStaticProps` 的是 `getServerSideProps`，用法是一样的。

因为 `getServerSideProps` 的请求时机是请求时，因此该函数的 context 参数包含了特定请求参数。

```typescript
export async function getServerSideProps(context) {
  return {
    props: {
      // props for your component
    },
  };
}
```

TTFB 时间会比 `getStaticProps` 慢，因为服务器必须在每个请求中计算结果，并且在没有额外配置的情况下无法通过 CDN 缓存结果
