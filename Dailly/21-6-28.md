# 记一次“简单的”业务改造

1. ts改造
2. 接口请求fallback
3. 堆上一点点细节
4. Code Spell Checker
5. useAntTable + 去除不必要的redux
6. useAntTable改造（ts类型、mutate、pagination）
7. CopyTooltip
8. 路由缓存处理

## 背景

从 Vue 初转 React 技术栈，刚好有个通用业务场景练练手，顺便记录一下自己追逐“最佳实践”的过程（虽然很可能一个月后就会变成自己都嫌弃的 🌶 🐔 代码）。

结果不重要，重要的是优化思路和实践过程。**本篇不会长篇累牍讲所有技术实现细节，只拎出来我认为最关键的部分**，毕竟打工人的时间有限...

## 场景

对于下面这样一个简单的后台管理系统表格展示界面，我们应该早已司空见惯：

![image.png](https://i.loli.net/2021/06/28/cYZQs3trPmpgkOH.png)

以 React + React-router + Redux + TypeScript + Antd 技术栈为前提，我们在一时间可能会草拟出以下的组件划分思路：

![cYZQs3trPmpgkOH.png](https://i.loli.net/2021/06/28/89ik2UxzdOZImJr.png)

## 过程

上图乍看没有错，并且 Antd 已经帮我们完成了绝大部分工作，但是当我接手项目的时候很快就发现了第一个扎眼的问题：TypeScript 类型缺失。对于处女座来说不能忍，于是首先开启的是疯狂的“补齐”之旅...

### TypeScript 改造

#### 1. 接口请求方法

直接先找到动态数据的源头——异步请求：

```diff
+ import { ActivityList } from 'src/types'
export function getConnectList(params: ConnectListParams) {
- return request.get('/v1/offline-business-connect/list', {
+ return request.get<ActivityList>('/v1/offline-business-connect/list', {
    params: {
      is_close: params.isClose || '',
      page: params.page || 1,
      page_size: params.page_size || 10,
      keyword: params.keyword || '',
    },
  });
}
```
